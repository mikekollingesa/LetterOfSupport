// Opens your Canvas app for the current record in a dialog
function ESAMK_openSpecifierPicker(primaryControl) {
  try {
    var fc = (primaryControl && primaryControl.data) ? primaryControl
             : (typeof Xrm !== "undefined" && Xrm.Page ? Xrm.Page : null);

    var id = fc && fc.data && fc.data.entity && fc.data.entity.getId ? fc.data.entity.getId() : null;
    if (!id) { Xrm.Navigation.openAlertDialog({ text: "Save the record first, then try again." }); return; }
    id = id.replace(/[{}]/g, "");

    // YOUR ACTUAL VALUES
    var CANVAS_APP_ID = "624aec80-d5b5-4d86-b4d8-ecb67225f936"; // Canvas app GUID
    var TABLE_NAME    = "esamk_letterofsupport1";                // logical table name

    Xrm.Navigation.navigateTo(
      {
        pageType: "webresource",
        webresourceName: "msdyn_/CanvasAppHost.html",
        data:
          "app-id="     + encodeURIComponent(CANVAS_APP_ID) +
          "&recordId="  + encodeURIComponent(id) +
          "&entityName="+ encodeURIComponent(TABLE_NAME)
      },
      {
        target: 2, position: 1,
        width:  { value: 900, unit: "px" },
        height: { value: 650, unit: "px" },
        title:  "Change Specifiers"
      }
    );
  } catch (e) {
    console.error("ESAMK_openSpecifierPicker error:", e);
    try { Xrm.Navigation.openErrorDialog({ message: String(e.message || e) }); } catch(_) {}
  }
}
