function saveIfBusinessUnitIsSet(executionContext) {
    var formContext = executionContext.getFormContext();

    // Check if it's a new record (no ID yet)
    if (formContext.data.entity.getId()) {
        console.log("Record already exists. Skipping BU auto-fill.");
        return;
    }

    console.log("Attempting to auto-fill Owning Business Unit with 'ESA_AOF_Default'...");

    // Search for the dummy business unit by name
    Xrm.WebApi.retrieveMultipleRecords("businessunit", "?$select=businessunitid,name&$filter=name eq 'ESA_AOF_Default'").then(
        function (result) {
            if (result.entities.length > 0) {
                var bu = result.entities[0];
                console.log("Found BU: " + bu.name + " (" + bu.businessunitid + ")");

                // Set the Owning Business Unit field
                formContext.getAttribute("owningbusinessunit").setValue([
                    {
                        id: bu.businessunitid,
                        entityType: "businessunit",
                        name: bu.name
                    }
                ]);

                console.log("Owning Business Unit field updated. Forcing save...");
                formContext.data.entity.save();
            } else {
                console.error("No Business Unit found with name 'ESA_AOF_Default'");
            }
        },
        function (error) {
            console.error("Error retrieving Business Unit: " + error.message);
        }
    );
}
