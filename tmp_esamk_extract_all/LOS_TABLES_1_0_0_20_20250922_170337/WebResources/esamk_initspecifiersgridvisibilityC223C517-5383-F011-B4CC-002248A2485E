// Hide/show the "specifiers_section" based on User Type

function initSpecifiersVisibilityByUserType(executionContext) {
  var fc = executionContext.getFormContext();

  // get User Type field value
  var attr = fc.getAttribute("esamk_jsusertype");
  if (!attr) {
    console.warn("User Type attribute not found");
    return;
  }

  // evaluate immediately
  toggleSpecifiersByUserType(fc);

  // also re-evaluate whenever User Type changes
  attr.addOnChange(function () {
    toggleSpecifiersByUserType(fc);
  });
}

function toggleSpecifiersByUserType(fc) {
  var attr = fc.getAttribute("esamk_jsusertype");
  var val = attr ? attr.getValue() : null;

  // ESA = 305290000 â†’ show, otherwise hide
  var show = (val === 305290000);
  setSectionVisible(fc, "specifiers_section", show);
}

function setSectionVisible(fc, sectionName, visible) {
  var tabs = fc.ui.tabs.get();
  for (var i = 0; i < tabs.length; i++) {
    var sections = tabs[i].sections.get();
    for (var j = 0; j < sections.length; j++) {
      if (sections[j].getName() === sectionName) {
        sections[j].setVisible(visible);
        return;
      }
    }
  }
}
