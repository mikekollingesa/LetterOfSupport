function SetOwnerAndTriggerFlow(executionContext) {
    var formContext = executionContext.getFormContext();
    var globalContext = Xrm.Utility.getGlobalContext();
    var userId = globalContext.userSettings.userId;

    console.log("ğŸ”¹ Checking if Owner needs to be set...");

    if (!formContext.data.entity.getId()) {
        console.log("ğŸ†• New Record Detected. Setting Owner...");

        var ownerReference = [{
            id: userId,
            entityType: "systemuser"
        }];
        formContext.getAttribute("ownerid").setValue(ownerReference);

        console.log("âœ… Owner Set to: " + userId);

        // ğŸ”¹ Force Save after setting Owner
        setTimeout(function () {
            console.log("ğŸ’¾ Auto-Saving to Generate Record ID...");
            formContext.data.entity.save();
        }, 2000);
    } else {
        console.log("ğŸ“ Record already saved. Updating Hidden Field to Trigger Flow...");

        // ğŸ”¥ Update a hidden field to trigger Power Automate
        formContext.getAttribute("esamk_triggerflow").setValue(new Date().toISOString());
        formContext.data.entity.save();
    }
}
